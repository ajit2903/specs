<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Derivation - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/protocol/isthmus/derivation.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="isthmus-l2-chain-derivation-changes"><a class="header" href="#isthmus-l2-chain-derivation-changes">Isthmus L2 Chain Derivation Changes</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#network-upgrade-automation-transactions">Network upgrade automation transactions</a>
<ul>
<li><a href="#l1block-deployment">L1Block deployment</a></li>
<li><a href="#gaspriceoracle-deployment">GasPriceOracle deployment</a></li>
<li><a href="#operator-fee-vault-deployment">Operator fee vault deployment</a></li>
<li><a href="#l1block-proxy-update">L1Block Proxy Update</a></li>
<li><a href="#gaspriceoracle-proxy-update">GasPriceOracle Proxy Update</a></li>
<li><a href="#operatorfeevault-proxy-update">OperatorFeeVault Proxy Update</a></li>
<li><a href="#gaspriceoracle-enable-isthmus">GasPriceOracle Enable Isthmus</a></li>
<li><a href="#eip-2935-contract-deployment">EIP-2935 Contract Deployment</a></li>
</ul>
</li>
<li><a href="#span-batch-updates">Span Batch Updates</a>
<ul>
<li><a href="#activation">Activation</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="network-upgrade-automation-transactions"><a class="header" href="#network-upgrade-automation-transactions">Network upgrade automation transactions</a></h1>
<p>The Isthmus hardfork activation block contains the following transactions, in this order:</p>
<ul>
<li>L1 Attributes Transaction</li>
<li>User deposits from L1</li>
<li>Network Upgrade Transactions
<ul>
<li>L1Block deployment</li>
<li>GasPriceOracle deployment</li>
<li>Operator Fee vault deployment</li>
<li>Update L1Block Proxy ERC-1967 Implementation</li>
<li>Update GasPriceOracle Proxy ERC-1967 Implementation</li>
<li>Update Operator Fee vault Proxy ERC-1967 Implementation</li>
<li>GasPriceOracle Enable Isthmus</li>
<li>EIP-2935 Contract Deployment</li>
</ul>
</li>
</ul>
<p>To not modify or interrupt the system behavior around gas computation, this block will not include any sequenced
transactions by setting <code>noTxPool: true</code>.</p>
<h2 id="l1block-deployment"><a class="header" href="#l1block-deployment">L1Block deployment</a></h2>
<p>The <code>L1Block</code> contract is upgraded to support the Isthmus operator fee feature.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x4210000000000000000000000000000000000003</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>425,000</code></li>
<li><code>data</code>: <code>0x60806040523480156100105...</code> (<a href="../../static/bytecode/isthmus-l1-block-deployment.txt">full bytecode</a>)</li>
<li><code>sourceHash</code>: <code>0x3b2d0821ca2411ad5cd3595804d1213d15737188ae4cbd58aa19c821a6c211bf</code>,
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: L1 Block Deployment"</li>
</ul>
<p>This results in the Isthmus L1Block contract being deployed to <code>0xFf256497D61dcd71a9e9Ff43967C13fdE1F72D12</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x4210000000000000000000000000000000000003
Computed Address: 0xFf256497D61dcd71a9e9Ff43967C13fdE1F72D12
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: L1 Block Deployment"))
# 0x3b2d0821ca2411ad5cd3595804d1213d15737188ae4cbd58aa19c821a6c211bf
</code></pre>
<p>Verify <code>data</code>:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/L1Block.sol/L1Block.json
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash
<code>0x8e3fe7a416d3e5f3b7be74ddd4e7e58e516fa3f80b67c6d930e3cd7297da4a4b</code>.</p>
<p>To verify the code hash:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
cast k $(jq -r ".deployedBytecode.object" packages/contracts-bedrock/forge-artifacts/L1Block.sol/L1Block.json)
</code></pre>
<h2 id="gaspriceoracle-deployment"><a class="header" href="#gaspriceoracle-deployment">GasPriceOracle deployment</a></h2>
<p>The <code>GasPriceOracle</code> contract is also upgraded to support the Isthmus operator fee feature.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x4210000000000000000000000000000000000004</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>1,625,000</code></li>
<li><code>data</code>: <code>0x60806040523480156100105...</code> (<a href="../../static/bytecode/isthmus-gas-price-oracle-deployment.txt">full bytecode</a>)</li>
<li><code>sourceHash</code>: <code>0xfc70b48424763fa3fab9844253b4f8d508f91eb1f7cb11a247c9baec0afb8035</code>,
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: Gas Price Oracle Deployment"</li>
</ul>
<p>This results in the Isthmus GasPriceOracle contract being deployed to <code>0x93e57A196454CB919193fa9946f14943cf733845</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x4210000000000000000000000000000000000003
Computed Address: 0xFf256497D61dcd71a9e9Ff43967C13fdE1F72D12
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: Gas Price Oracle Deployment"))
# 0xfc70b48424763fa3fab9844253b4f8d508f91eb1f7cb11a247c9baec0afb8035
</code></pre>
<p>Verify <code>data</code>:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/GasPriceOracle.sol/GasPriceOracle.json
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash
<code>0x4d195a9d7caf9fb6d4beaf80de252c626c853afd5868c4f4f8d19c9d301c2679</code>.</p>
<p>To verify the code hash:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
cast k $(jq -r ".deployedBytecode.object" packages/contracts-bedrock/forge-artifacts/GasPriceOracle.sol/GasPriceOracle.json)
</code></pre>
<h2 id="operator-fee-vault-deployment"><a class="header" href="#operator-fee-vault-deployment">Operator fee vault deployment</a></h2>
<p>A new <code>OperatorFeeVault</code> contract has been created to receive the operator fees. The contract is created
with the following arguments:</p>
<ul>
<li>Recipient address: The base fee vault</li>
<li>Min withdrawal amount: 0</li>
<li>Withdrawal network: L2</li>
</ul>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x4210000000000000000000000000000000000005</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>500,000</code></li>
<li><code>data</code>: <code>0x60806040523480156100105...</code> (<a href="../../static/bytecode/isthmus-operator-fee-deployment.txt">full bytecode</a>)</li>
<li><code>sourceHash</code>: <code>0x107a570d3db75e6110817eb024f09f3172657e920634111ce9875d08a16daa96</code>,
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: Operator Fee Vault Deployment"</li>
</ul>
<p>This results in the Isthmus OperatorFeeVault contract being deployed to
<code>0x4fa2Be8cd41504037F1838BcE3bCC93bC68Ff537</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x4210000000000000000000000000000000000003
Computed Address: 0x4fa2Be8cd41504037F1838BcE3bCC93bC68Ff537
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: Operator Fee Vault Deployment"))
# 0x107a570d3db75e6110817eb024f09f3172657e920634111ce9875d08a16daa96
</code></pre>
<p>Verify <code>data</code>:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/OperatorFeeVault.sol/OperatorFeeVault.json
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash
<code>0x57dc55c9c09ca456fa728f253fe7b895d3e6aae0706104935fe87c7721001971</code>.</p>
<p>To verify the code hash:</p>
<pre><code class="language-bash">git checkout 9436dba8c4c906e36675f5922e57d1b55582889e
make build-contracts
export ETH_RPC_URL=https://mainnet.optimism.io # Any RPC running Cancun or Prague
cast k $(cast call --create $(jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/OperatorFeeVault.sol/OperatorFeeVault.json))
</code></pre>
<p>Note that this verification differs from the other deployments because the <code>OperatorFeeVault</code>
inherits the <code>FeeVault</code> contract which contains immutables. So the deployment bytecode has to be
executed on an EVM to get the actual deployed contract bytecode. But it sets all immutables to fixed
constants, so the resulting code hash is constant.</p>
<h2 id="l1block-proxy-update"><a class="header" href="#l1block-proxy-update">L1Block Proxy Update</a></h2>
<p>This transaction updates the L1Block Proxy ERC-1967 implementation slot to point to the new L1Block deployment.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x0000000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>0x4200000000000000000000000000000000000015</code> (L1Block Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>50,000</code></li>
<li><code>data</code>: <code>0x3659cfe6000000000000000000000000ff256497d61dcd71a9e9ff43967c13fde1f72d12</code></li>
<li><code>sourceHash</code>: <code>0xebe8b5cb10ca47e0d8bda8f5355f2d66711a54ddeb0ef1d30e29418c9bf17a0e</code>
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: L1 Block Proxy Update"</li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast concat-hex $(cast sig "upgradeTo(address)") $(cast abi-encode "upgradeTo(address)" 0xff256497d61dcd71a9e9ff43967c13fde1f72d12)
0x3659cfe6000000000000000000000000ff256497d61dcd71a9e9ff43967c13fde1f72d12
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: L1 Block Proxy Update"))
# 0xebe8b5cb10ca47e0d8bda8f5355f2d66711a54ddeb0ef1d30e29418c9bf17a0e
</code></pre>
<h2 id="gaspriceoracle-proxy-update"><a class="header" href="#gaspriceoracle-proxy-update">GasPriceOracle Proxy Update</a></h2>
<p>This transaction updates the GasPriceOracle Proxy ERC-1967 implementation slot to point to the new GasPriceOracle
deployment.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x0000000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>0x420000000000000000000000000000000000000F</code> (Gas Price Oracle Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>50,000</code></li>
<li><code>data</code>: <code>0x3659cfe600000000000000000000000093e57a196454cb919193fa9946f14943cf733845</code></li>
<li><code>sourceHash</code>: <code>0xecf2d9161d26c54eda6b7bfdd9142719b1e1199a6e5641468d1bf705bc531ab0</code>
computed with the "Upgrade-deposited" type, with <code>intent = "Isthmus: Gas Price Oracle Proxy Update"</code></li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast concat-hex $(cast sig "upgradeTo(address)") $(cast abi-encode "upgradeTo(address)" 0x93e57a196454cb919193fa9946f14943cf733845)
0x3659cfe600000000000000000000000093e57a196454cb919193fa9946f14943cf733845
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: Gas Price Oracle Proxy Update"))
# 0xecf2d9161d26c54eda6b7bfdd9142719b1e1199a6e5641468d1bf705bc531ab0
</code></pre>
<h2 id="operatorfeevault-proxy-update"><a class="header" href="#operatorfeevault-proxy-update">OperatorFeeVault Proxy Update</a></h2>
<p>This transaction updates the GasPriceOracle Proxy ERC-1967 implementation slot to point to the new GasPriceOracle
deployment.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x0000000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>0x420000000000000000000000000000000000001B</code> (Operator Fee Vault Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>50,000</code></li>
<li><code>data</code>: <code>0x3659cfe60000000000000000000000004fa2be8cd41504037f1838bce3bcc93bc68ff537</code></li>
<li><code>sourceHash</code>: <code>0xad74e1adb877ccbe176b8fa1cc559388a16e090ddbe8b512f5b37d07d887a927</code>
computed with the "Upgrade-deposited" type, with <code>intent = "Isthmus: Operator Fee Vault Proxy Update"</code></li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast concat-hex $(cast sig "upgradeTo(address)") $(cast abi-encode "upgradeTo(address)" 0x4fa2be8cd41504037f1838bce3bcc93bc68ff537)
0x3659cfe60000000000000000000000004fa2be8cd41504037f1838bce3bcc93bc68ff537
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: Operator Fee Vault Proxy Update"))
# 0xad74e1adb877ccbe176b8fa1cc559388a16e090ddbe8b512f5b37d07d887a927
</code></pre>
<h2 id="gaspriceoracle-enable-isthmus"><a class="header" href="#gaspriceoracle-enable-isthmus">GasPriceOracle Enable Isthmus</a></h2>
<p>This transaction informs the GasPriceOracle to start using the Isthmus gas calculation formula.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0xDeaDDEaDDeAdDeAdDEAdDEaddeAddEAdDEAd0001</code> (Depositer Account)</li>
<li><code>to</code>: <code>0x420000000000000000000000000000000000000F</code> (Gas Price Oracle Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>90,000</code></li>
<li><code>data</code>: <code>0x291b0383</code></li>
<li><code>sourceHash</code>: <code>0x3ddf4b1302548dd92939826e970f260ba36167f4c25f18390a5e8b194b295319</code>,
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: Gas Price Oracle Set Isthmus"</li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast sig "setIsthmus()"
0x8e98b106
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: Gas Price Oracle Set Isthmus"))
# 0x3ddf4b1302548dd92939826e970f260ba36167f4c25f18390a5e8b194b295319
</code></pre>
<h2 id="eip-2935-contract-deployment"><a class="header" href="#eip-2935-contract-deployment">EIP-2935 Contract Deployment</a></h2>
<p><a href="https://eips.ethereum.org/EIPS/eip-2935">EIP-2935</a> requires a contract to be deployed. To deploy this contract,
a deposit transaction is created with attributes matching the EIP:</p>
<ul>
<li><code>from</code>: <code>0x3462413Af4609098e1E27A490f554f260213D685</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>250,000</code></li>
<li><code>data</code>: <code>0x60538060095f395ff33373fffffffffffffffffffffffffffffffffffffffe14604657602036036042575f35600143038111604257611fff81430311604257611fff9006545f5260205ff35b5f5ffd5b5f35611fff60014303065500</code></li>
<li><code>sourceHash</code>: <code>0xbfb734dae514c5974ddf803e54c1bc43d5cdb4a48ae27e1d9b875a5a150b553a</code>
computed with the "Upgrade-deposited" type, with `intent = "Isthmus: EIP-2935 Contract Deployment"</li>
</ul>
<p>This results in the EIP-2935 contract being deployed to <code>0x0000F90827F1C53a10cb7A02335B175320002935</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x3462413Af4609098e1E27A490f554f260213D685
Computed Address: 0x0000F90827F1C53a10cb7A02335B175320002935
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Isthmus: EIP-2935 Contract Deployment"))
# 0xbfb734dae514c5974ddf803e54c1bc43d5cdb4a48ae27e1d9b875a5a150b553a
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash
<code>0x6e49e66782037c0555897870e29fa5e552daf4719552131a0abce779daec0a5d</code>.</p>
<h1 id="span-batch-updates"><a class="header" href="#span-batch-updates">Span Batch Updates</a></h1>
<p><a href="../delta/span-batches.html">Span batches</a> are a span of consecutive L2 blocks than are batched submitted.</p>
<p>Span batches contain the L1 transactions and transaction types that are posted containing the span of L2 blocks.
Since <a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a> introduces a new transaction type, the Span Batch must be updated to support the <a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a>
transaction.</p>
<p>This corresponds with a new RLP-encoding of the <code>tx_datas</code> list as specified in
<a href="../delta/span-batches.html">the Delta span batch spec</a>, adding a new transaction type:</p>
<p>Transaction type <code>4</code> (<a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a> <code>SetCode</code>):
<code>0x04 ++ rlp_encode(value, max_priority_fee_per_gas, max_fee_per_gas, data, access_list, authorization_list)</code></p>
<p>The <a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a> transaction extends <a href="https://eips.ethereum.org/EIPS/eip-1559">EIP-1559</a> to include a new <code>authorization_list</code> field.
<code>authorization_list</code> is an RLP-encoded list of authorization tuples.
The <a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a> transaction format is as follows.</p>
<ul>
<li><code>value</code>: The transaction value as a <code>u256</code>.</li>
<li><code>max_priority_fee_per_gas</code>: The maximum priority fee per gas allowed as a <code>u256</code>.</li>
<li><code>max_fee_per_gas</code>: The maximum fee per gas as a <code>u256</code>.</li>
<li><code>data</code>: The transaction data bytes.</li>
<li><code>access_list</code>: The <a href="https://eips.ethereum.org/EIPS/eip-2930">EIP-2930</a> access list.</li>
<li><code>authorization_list</code>: The <a href="https://eips.ethereum.org/EIPS/eip-7702">EIP-7702</a> signed authorization list.</li>
</ul>
<h2 id="activation"><a class="header" href="#activation">Activation</a></h2>
<p>Singular batches with transactions of type <code>4</code> must only be accepted if Isthmus is active at the
timestamp of the batch. If a singular batch contains a transaction of type <code>4</code> before Isthmus is
active, this batch must be <em>dropped</em>. Note that if Holocene is active, this will also
lead to the remaining span batch, and channel that contained it, to get dropped.</p>
<p>Also note that this check must happen at the level of individual batches that are derived from span
batches, not to span batches as a whole. In particular, it is allowed for a span batch to span the
Isthmus activation timestamp and contain SetCode transactions in singular batches that have a
timestamp at or after the Isthmus activation time, even if the timestamp of the span batch is before
the Isthmus activation time.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../protocol/isthmus/exec-engine.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../protocol/isthmus/l1-attributes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../protocol/isthmus/exec-engine.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../protocol/isthmus/l1-attributes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../../specs/static/solidity.min.js"></script>
        <script src="../../specs/static/mermaid.min.js"></script>
        <script src="../../specs/static/mermaid-init.js"></script>


    </div>
    </body>
</html>
