<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Supervisor - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/css/footer.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/interop/supervisor.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="supervisor"><a class="header" href="#supervisor">Supervisor</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#rpc-api">RPC API</a>
<ul>
<li><a href="#common-types">Common types</a>
<ul>
<li><a href="#identifier"><code>Identifier</code></a></li>
<li><a href="#message"><code>Message</code></a></li>
<li><a href="#executingdescriptor"><code>ExecutingDescriptor</code></a></li>
<li><a href="#hexuint64"><code>HexUint64</code></a></li>
<li><a href="#int"><code>Int</code></a></li>
<li><a href="#chainid"><code>ChainID</code></a></li>
<li><a href="#hash"><code>Hash</code></a></li>
<li><a href="#bytes"><code>Bytes</code></a></li>
<li><a href="#blockid"><code>BlockID</code></a></li>
<li><a href="#blockref"><code>BlockRef</code></a></li>
<li><a href="#derivedidpair"><code>DerivedIDPair</code></a></li>
<li><a href="#chainrootinfo"><code>ChainRootInfo</code></a></li>
<li><a href="#supervisorsyncstatus"><code>SupervisorSyncStatus</code></a></li>
<li><a href="#supervisorchainsyncstatus"><code>SupervisorChainSyncStatus</code></a></li>
<li><a href="#superrootresponse"><code>SuperRootResponse</code></a></li>
<li><a href="#safetylevel"><code>SafetyLevel</code></a></li>
</ul>
</li>
<li><a href="#methods">Methods</a>
<ul>
<li><a href="#supervisor_crossderivedtosource"><code>supervisor_crossDerivedToSource</code></a></li>
<li><a href="#supervisor_localunsafe"><code>supervisor_localUnsafe</code></a></li>
<li><a href="#supervisor_crosssafe"><code>supervisor_crossSafe</code></a></li>
<li><a href="#supervisor_finalized"><code>supervisor_finalized</code></a></li>
<li><a href="#supervisor_finalizedl1"><code>supervisor_finalizedL1</code></a></li>
<li><a href="#supervisor_superrootattimestamp"><code>supervisor_superRootAtTimestamp</code></a></li>
<li><a href="#supervisor_syncstatus"><code>supervisor_syncStatus</code></a></li>
<li><a href="#supervisor_allsafederivedat"><code>supervisor_allSafeDerivedAt</code></a></li>
<li><a href="#supervisor_checkaccesslist"><code>supervisor_checkAccessList</code></a>
<ul>
<li><a href="#access-list-contents">Access-list contents</a></li>
<li><a href="#access-list-execution-context">Access-list execution context</a></li>
<li><a href="#access-list-checks">Access-list checks</a></li>
<li><a href="#supervisor_checkaccesslist-contents"><code>supervisor_checkAccessList</code> contents</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#errors">Errors</a>
<ul>
<li><a href="#json-rpc-error-codes">JSON-RPC Error Codes</a></li>
<li><a href="#error-code-structure">Error Code Structure</a></li>
<li><a href="#protocol-specific-error-codes">Protocol Specific Error Codes</a>
<ul>
<li><a href="#-3204xx-deadline_exceeded-errors"><code>-3204XX</code> <code>DEADLINE_EXCEEDED</code> errors</a>
<ul>
<li><a href="#-320400-uninitialized_chain_database"><code>-320400</code> <code>UNINITIALIZED_CHAIN_DATABASE</code></a></li>
</ul>
</li>
<li><a href="#-3205xx-not_found-errors"><code>-3205XX</code> <code>NOT_FOUND</code> errors</a>
<ul>
<li><a href="#-320500-skipped_data"><code>-320500</code> <code>SKIPPED_DATA</code></a></li>
<li><a href="#-320501-unknown_chain"><code>-320501</code> <code>UNKNOWN_CHAIN</code></a></li>
</ul>
</li>
<li><a href="#-3206xx-already_exists-errors"><code>-3206XX</code> <code>ALREADY_EXISTS</code> errors</a>
<ul>
<li><a href="#-320600-conflicting_data"><code>-320600</code> <code>CONFLICTING_DATA</code></a></li>
<li><a href="#-320601-ineffective_data"><code>-320601</code> <code>INEFFECTIVE_DATA</code></a></li>
</ul>
</li>
<li><a href="#-3209xx-failed_precondition-errors"><code>-3209XX</code> <code>FAILED_PRECONDITION</code> errors</a>
<ul>
<li><a href="#-320900-out_of_order"><code>-320900</code> <code>OUT_OF_ORDER</code></a></li>
<li><a href="#-320901-awaiting_replacement_block"><code>-320901</code> <code>AWAITING_REPLACEMENT_BLOCK</code></a></li>
</ul>
</li>
<li><a href="#-3210xx-aborted-errors"><code>-3210XX</code> <code>ABORTED</code> errors</a>
<ul>
<li><a href="#-321000-iter_stop"><code>-321000</code> <code>ITER_STOP</code></a></li>
</ul>
</li>
<li><a href="#-3211xx-out_of_range-errors"><code>-3211XX</code> <code>OUT_OF_RANGE</code> errors</a>
<ul>
<li><a href="#-321100-out_of_scope"><code>-321100</code> <code>OUT_OF_SCOPE</code></a></li>
</ul>
</li>
<li><a href="#-3212xx-unimplemented-errors"><code>-3212XX</code> <code>UNIMPLEMENTED</code> errors</a>
<ul>
<li><a href="#-321200-cannot_get_parent_of_first_block_in_db"><code>-321200</code> <code>CANNOT_GET_PARENT_OF_FIRST_BLOCK_IN_DB</code></a></li>
</ul>
</li>
<li><a href="#-3214xx-unavailable-errors"><code>-3214XX</code> <code>UNAVAILABLE</code> errors</a>
<ul>
<li><a href="#-321401-future_data"><code>-321401</code> <code>FUTURE_DATA</code></a></li>
</ul>
</li>
<li><a href="#-3215xx-data_loss-errors"><code>-3215XX</code> <code>DATA_LOSS</code> errors</a>
<ul>
<li><a href="#-321500-missed_data"><code>-321500</code> <code>MISSED_DATA</code></a></li>
<li><a href="#-321501-data_corruption"><code>-321501</code> <code>DATA_CORRUPTION</code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The supervisor is an implementation detail of OP Stack native interop and is not the only
architecture that can be used to implement it. The supervisor is responsible for indexing
data from all of the chains in a cluster so that the <a href="./verifier.html#safety">safety level</a>
of executing messages can quickly be determined.</p>
<h2 id="rpc-api"><a class="header" href="#rpc-api">RPC API</a></h2>
<h3 id="common-types"><a class="header" href="#common-types">Common types</a></h3>
<h4 id="identifier"><a class="header" href="#identifier"><code>Identifier</code></a></h4>
<p>The identifier of a message.
Corresponds to an <a href="./messaging.html#message-identifier">Identifier</a>.</p>
<p>Object:</p>
<ul>
<li><code>origin</code>: <code>Address</code></li>
<li><code>blockNumber</code>: <code>HexUint64</code></li>
<li><code>logIndex</code>: <code>HexUint64</code></li>
<li><code>timestamp</code>: <code>HexUint64</code></li>
<li><code>chainID</code>: <code>ChainID</code></li>
</ul>
<h4 id="message"><a class="header" href="#message"><code>Message</code></a></h4>
<p>Describes an initiating message.</p>
<p>Object:</p>
<ul>
<li><code>identifier</code>: <code>Identifier</code> - identifier of the message</li>
<li><code>payloadHash</code>: <code>Hash</code> - <code>keccak256</code> hash of the message-payload bytes</li>
</ul>
<h4 id="executingdescriptor"><a class="header" href="#executingdescriptor"><code>ExecutingDescriptor</code></a></h4>
<p>Describes the context for message verification.
Specifically, this helps apply message-expiry rules on message checks.</p>
<p>Object:</p>
<ul>
<li><code>timestamp</code>: <code>HexUint64</code> - expected timestamp during message execution.</li>
<li><code>timeout</code>: <code>HexUint64</code> - optional, requests verification to still hold at <code>timestamp+timeout</code> (inclusive).
The message expiry-window may invalidate messages.
Default interpretation is a <code>0</code> timeout: what is valid at <code>timestamp</code> may not be valid at <code>timestamp+1</code>.</li>
</ul>
<h4 id="hexuint64"><a class="header" href="#hexuint64"><code>HexUint64</code></a></h4>
<p><code>STRING</code>:
Hex-encoded big-endian number, variable length up to 64 bits, prefixed with <code>0x</code>.</p>
<h4 id="int"><a class="header" href="#int"><code>Int</code></a></h4>
<p><code>NUMBER</code>:
Regular JSON number, always integer. Assumed to always fit in 51 bits.</p>
<h4 id="chainid"><a class="header" href="#chainid"><code>ChainID</code></a></h4>
<p><code>STRING</code>:
Hex-encoded big-endian number, variable length up to 256 bits, prefixed with <code>0x</code>.</p>
<h4 id="hash"><a class="header" href="#hash"><code>Hash</code></a></h4>
<p><code>STRING</code>:
Hex-encoded, fixed-length, representing 32 bytes, prefixed with <code>0x</code>.</p>
<h4 id="bytes"><a class="header" href="#bytes"><code>Bytes</code></a></h4>
<p><code>STRING</code>:
Hex-encoded, variable length (always full bytes, no odd number of nibbles),
representing a bytes list, prefixed with <code>0x</code>.</p>
<h4 id="blockid"><a class="header" href="#blockid"><code>BlockID</code></a></h4>
<p>Describes a block.</p>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>hash</code>: <code>Hash</code> - block hash</li>
<li><code>number</code>: <code>Int</code> - block number</li>
</ul>
<h4 id="blockref"><a class="header" href="#blockref"><code>BlockRef</code></a></h4>
<p>Describes a block.</p>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>hash</code>: <code>Hash</code> - block hash</li>
<li><code>number</code>: <code>Int</code> - block number</li>
<li><code>parentHash</code>: <code>Hash</code> - block parent-hash</li>
<li><code>timestamp</code>: <code>Int</code> - block timestamp</li>
</ul>
<h4 id="derivedidpair"><a class="header" href="#derivedidpair"><code>DerivedIDPair</code></a></h4>
<p>A pair of block identifiers, linking a <code>derived</code> block to the <code>source</code> block from which it was derived.</p>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>source</code>: <code>BlockID</code> - The block ID of the <code>source</code> block.</li>
<li><code>derived</code>: <code>BlockID</code> - The block ID of the <code>derived</code> block.</li>
</ul>
<h4 id="chainrootinfo"><a class="header" href="#chainrootinfo"><code>ChainRootInfo</code></a></h4>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>chainId</code>: <code>HexUint64</code> - The chain ID (Note: this is changing to <code>ChainID</code> soon)</li>
<li><code>canonical</code>: <code>Hash</code> - output root at the latest canonical block</li>
<li><code>pending</code>: <code>Bytes</code> - output root preimage</li>
</ul>
<h4 id="supervisorsyncstatus"><a class="header" href="#supervisorsyncstatus"><code>SupervisorSyncStatus</code></a></h4>
<p>Describes the sync status of the Supervisor component. Fields <code>minSyncedL1</code>,
<code>safeTimestamp</code> and <code>finalizedTimestamp</code> are set as the minimum value among
chains in <code>chains</code>.</p>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>minSyncedL1</code>: <code>BlockRef</code> - block ref to the synced L1 block</li>
<li><code>safeTimestamp</code>: <code>Int</code> - safe timestamp</li>
<li><code>finalizedTimestamp</code>: <code>Int</code> - finalized timestamp</li>
<li><code>chains</code>: <code>OBJECT</code> with <code>ChainID</code> keys and <code>SupervisorChainSyncStatus</code> values</li>
</ul>
<h4 id="supervisorchainsyncstatus"><a class="header" href="#supervisorchainsyncstatus"><code>SupervisorChainSyncStatus</code></a></h4>
<p>Describes the sync status for a specific chain</p>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>localUnsafe</code>: <code>BlockRef</code> - local-unsafe ref for the given chain</li>
<li><code>localSafe</code>: <code>BlockID</code> - local-safe ref for the given chain</li>
<li><code>crossUnsafe</code>: <code>BlockID</code> - cross-unsafe ref for the given chain</li>
<li><code>safe</code>: <code>BlockID</code> - cross-safe ref for the given chain</li>
<li><code>finalized</code>: <code>BlockID</code> - finalized ref for the given chain</li>
</ul>
<h4 id="superrootresponse"><a class="header" href="#superrootresponse"><code>SuperRootResponse</code></a></h4>
<p><code>OBJECT</code>:</p>
<ul>
<li><code>crossSafeDerivedFrom</code>: <code>BlockID</code> - common derived-from where all chains are cross-safe</li>
<li><code>timestamp</code>: <code>Int</code> - The timestamp of the super root</li>
<li><code>superRoot</code>: <code>Hash</code> - The root of the super root</li>
<li><code>version</code>: <code>Int</code> - The version of the response</li>
<li><code>chains</code>: <code>ARRAY</code> of <code>ChainRootInfo</code> - List of chains included in the super root</li>
</ul>
<h4 id="safetylevel"><a class="header" href="#safetylevel"><code>SafetyLevel</code></a></h4>
<p>The safety level of the message.
Corresponds to a verifier <a href="./verifier.html#safety">SafetyLevel</a>.</p>
<p><code>STRING</code>, one of:</p>
<ul>
<li><code>invalid</code></li>
<li><code>unsafe</code>: equivalent to safety of the <code>latest</code> RPC label.</li>
<li><code>cross-unsafe</code></li>
<li><code>local-safe</code></li>
<li><code>safe</code>: matching cross-safe, named <code>safe</code> to match the RPC label.</li>
<li><code>finalized</code></li>
</ul>
<h3 id="methods"><a class="header" href="#methods">Methods</a></h3>
<h4 id="supervisor_crossderivedtosource"><a class="header" href="#supervisor_crossderivedtosource"><code>supervisor_crossDerivedToSource</code></a></h4>
<p>Parameters:</p>
<ul>
<li><code>chainID</code>: <code>ChainID</code></li>
<li><code>derived</code>: <code>BlockID</code></li>
</ul>
<p>Returns: derivedFrom <code>BlockRef</code></p>
<h4 id="supervisor_localunsafe"><a class="header" href="#supervisor_localunsafe"><code>supervisor_localUnsafe</code></a></h4>
<p>Parameters:</p>
<ul>
<li><code>chainID</code>: <code>ChainID</code></li>
</ul>
<p>Returns: <code>BlockID</code></p>
<h4 id="supervisor_crosssafe"><a class="header" href="#supervisor_crosssafe"><code>supervisor_crossSafe</code></a></h4>
<p>Parameters:</p>
<ul>
<li><code>chainID</code>: <code>ChainID</code></li>
</ul>
<p>Returns: <code>DerivedIDPair</code></p>
<h4 id="supervisor_finalized"><a class="header" href="#supervisor_finalized"><code>supervisor_finalized</code></a></h4>
<p>Parameters:</p>
<ul>
<li><code>chainID</code>: <code>ChainID</code></li>
</ul>
<p>Returns: <code>BlockID</code></p>
<h4 id="supervisor_finalizedl1"><a class="header" href="#supervisor_finalizedl1"><code>supervisor_finalizedL1</code></a></h4>
<p>Parameters: (none)</p>
<p>Returns: <code>BlockRef</code></p>
<h4 id="supervisor_superrootattimestamp"><a class="header" href="#supervisor_superrootattimestamp"><code>supervisor_superRootAtTimestamp</code></a></h4>
<p>Retrieves the super root state at the specified timestamp,
which represents the global state across all monitored chains.</p>
<p>Parameters:</p>
<ul>
<li><code>timestamp</code>: <code>HexUint64</code></li>
</ul>
<p>Returns: <code>SuperRootResponse</code></p>
<h4 id="supervisor_syncstatus"><a class="header" href="#supervisor_syncstatus"><code>supervisor_syncStatus</code></a></h4>
<p>Parameters: (none)</p>
<p>Returns: <code>SupervisorSyncStatus</code>.
Throws: Some error if set of supervised chains is empty.</p>
<h4 id="supervisor_allsafederivedat"><a class="header" href="#supervisor_allsafederivedat"><code>supervisor_allSafeDerivedAt</code></a></h4>
<p>Returns the last derived block for each chain, from the given L1 block.</p>
<p>Parameters:</p>
<ul>
<li><code>derivedFrom</code>: <code>BlockID</code></li>
</ul>
<p>Returns: derived blocks, mapped in a <code>OBJECT</code>:</p>
<ul>
<li>key: <code>ChainID</code></li>
<li>value: <code>BlockID</code></li>
</ul>
<h4 id="supervisor_checkaccesslist"><a class="header" href="#supervisor_checkaccesslist"><code>supervisor_checkAccessList</code></a></h4>
<p>Verifies if an access-list, as defined in <a href="https://eips.ethereum.org/EIPS/eip-2930">EIP-2930</a>, references only valid messages.
Message execution in the <a href="./predeploys.html#crossl2inbox"><code>CrossL2Inbox</code></a> that is statically declared in the access-list will not revert.</p>
<h5 id="access-list-contents"><a class="header" href="#access-list-contents">Access-list contents</a></h5>
<p>Only the <a href="./predeploys.html#crossl2inbox"><code>CrossL2Inbox</code></a> subset of the access-list in the transaction is required,
storage-access by other addresses is not included.</p>
<p>Note that an access-list can contain multiple different storage key lists for the <code>CrossL2Inbox</code> address.
All storage keys applicable to the <code>CrossL2Inbox</code> MUST be joined together (preserving ordering),
missing storage-keys breaks inbox safety.</p>
<p><strong>ALL storage-keys in the access-list for the <code>CrossL2Inbox</code> MUST be checked.</strong>
If there is any unrecognized or invalid key, the access-list check MUST fail.</p>
<h5 id="access-list-execution-context"><a class="header" href="#access-list-execution-context">Access-list execution context</a></h5>
<p>The provided execution-context is used to determine validity relative to the provided time constraints,
see <a href="./derivation.html#invariants">timestamp invariants</a>.</p>
<p>Since messages expire, validity is not definitive.
To reserve validity for a longer time range, a non-zero <code>timeout</code> value can be used.
See <a href="#executingdescriptor"><code>ExecutingDescriptor</code></a> documentation.</p>
<p>As block-builder a <code>timeout</code> of <code>0</code> should be used.</p>
<p>As transaction pre-verifier, a <code>timeout</code> of <code>86400</code> (1 day) should be used.
The transaction should be re-verified or dropped after this time duration,
as it can no longer be safely included in the block due to message-expiry.</p>
<h5 id="access-list-checks"><a class="header" href="#access-list-checks">Access-list checks</a></h5>
<p>The access-list check errors are not definite state-transition blockers, the RPC based checks can be extra conservative.
I.e. a message that is uncertain to meet the requested safety level may be denied.
Specifically, no attempt may be made to verify messages that are initiated and executed within the same timestamp,
these are <code>invalid</code> by default.
Advanced block-builders may still choose to include these messages by verifying the intra-block constraints.</p>
<h5 id="supervisor_checkaccesslist-contents"><a class="header" href="#supervisor_checkaccesslist-contents"><code>supervisor_checkAccessList</code> contents</a></h5>
<p>Parameters:</p>
<ul>
<li><code>inboxEntries</code>: <code>ARRAY</code> of <code>Hash</code> - statically declared <code>CrossL2Inbox</code> access entries.</li>
<li><code>minSafety</code>: <code>SafetyLevel</code> - minimum required safety, one of:
<ul>
<li><code>unsafe</code>: the message exists.</li>
<li><code>cross-unsafe</code>: the message exists in a cross-unsafe block.</li>
<li><code>local-safe</code>: the message exists in a local-safe block, not yet cross-verified.</li>
<li><code>safe</code>: the message exists in a derived block that is cross-verified.</li>
<li><code>finalized</code>: the message exists in a finalized block.</li>
<li>Other safety levels are invalid and result in an error.</li>
</ul>
</li>
<li><code>executingDescriptor</code>: <code>ExecutingDescriptor</code> - applies as execution-context to all messages.</li>
</ul>
<p>Returns: RPC error if the <code>minSafety</code> is not met by one or more of the access entries.</p>
<p>The access-list entries represent messages, and may be incomplete or malformed.
Malformed access-lists result in an RPC error.</p>
<h3 id="errors"><a class="header" href="#errors">Errors</a></h3>
<p>The Supervisor RPC API uses a 6-digit error code system that extends standard JSON-RPC error codes
while providing additional categorization based on gRPC status codes.</p>
<p>For standard JSON-RPC error codes, refer to <a href="https://ethereum-json-rpc.com/errors">Ethereum JSON-RPC Error Reference</a>.</p>
<h4 id="json-rpc-error-codes"><a class="header" href="#json-rpc-error-codes">JSON-RPC Error Codes</a></h4>
<h4 id="error-code-structure"><a class="header" href="#error-code-structure">Error Code Structure</a></h4>
<p>Supervisor error codes follow this structure:</p>
<ul>
<li>First 2 digits: <code>32</code> (indicating server error, matching JSON-RPC conventions)</li>
<li>Middle 2 digits: gRPC status code category (01-16, zero-padded)</li>
<li>Last 2 digits: Specific error index within that category (00-99)</li>
</ul>
<p>For gRPC status codes reference, see <a href="https://grpc.io/docs/guides/status-codes/">gRPC Status Codes</a>.</p>
<h4 id="protocol-specific-error-codes"><a class="header" href="#protocol-specific-error-codes">Protocol Specific Error Codes</a></h4>
<h5 id="-3204xx-deadline_exceeded-errors"><a class="header" href="#-3204xx-deadline_exceeded-errors"><code>-3204XX</code> <code>DEADLINE_EXCEEDED</code> errors</a></h5>
<h6 id="-320400-uninitialized_chain_database"><a class="header" href="#-320400-uninitialized_chain_database"><code>-320400</code> <code>UNINITIALIZED_CHAIN_DATABASE</code></a></h6>
<p>Happens when a chain database is not initialized yet.</p>
<h5 id="-3205xx-not_found-errors"><a class="header" href="#-3205xx-not_found-errors"><code>-3205XX</code> <code>NOT_FOUND</code> errors</a></h5>
<h6 id="-320500-skipped_data"><a class="header" href="#-320500-skipped_data"><code>-320500</code> <code>SKIPPED_DATA</code></a></h6>
<p>Happens when we try to retrieve data that is not available (pruned).
It may also happen if we erroneously skip data, that was not considered a conflict, if the DB is corrupted.</p>
<h6 id="-320501-unknown_chain"><a class="header" href="#-320501-unknown_chain"><code>-320501</code> <code>UNKNOWN_CHAIN</code></a></h6>
<p>Happens when a chain is unknown, not in the dependency set.</p>
<h5 id="-3206xx-already_exists-errors"><a class="header" href="#-3206xx-already_exists-errors"><code>-3206XX</code> <code>ALREADY_EXISTS</code> errors</a></h5>
<h6 id="-320600-conflicting_data"><a class="header" href="#-320600-conflicting_data"><code>-320600</code> <code>CONFLICTING_DATA</code></a></h6>
<p>Happens when we know for sure that there is different canonical data.</p>
<h6 id="-320601-ineffective_data"><a class="header" href="#-320601-ineffective_data"><code>-320601</code> <code>INEFFECTIVE_DATA</code></a></h6>
<p>Happens when data is accepted as compatible, but did not change anything.
This happens when a node is deriving an L2 block we already know of being derived from the given source,
but without path to skip forward to newer source blocks without doing the known derivation work first.</p>
<h5 id="-3209xx-failed_precondition-errors"><a class="header" href="#-3209xx-failed_precondition-errors"><code>-3209XX</code> <code>FAILED_PRECONDITION</code> errors</a></h5>
<h6 id="-320900-out_of_order"><a class="header" href="#-320900-out_of_order"><code>-320900</code> <code>OUT_OF_ORDER</code></a></h6>
<p>Happens when you try to add data to the DB, but it does not actually fit onto the latest data
(by being too old or new).</p>
<h6 id="-320901-awaiting_replacement_block"><a class="header" href="#-320901-awaiting_replacement_block"><code>-320901</code> <code>AWAITING_REPLACEMENT_BLOCK</code></a></h6>
<p>Happens when we know for sure that a replacement block is needed before progress can be made.</p>
<h5 id="-3210xx-aborted-errors"><a class="header" href="#-3210xx-aborted-errors"><code>-3210XX</code> <code>ABORTED</code> errors</a></h5>
<h6 id="-321000-iter_stop"><a class="header" href="#-321000-iter_stop"><code>-321000</code> <code>ITER_STOP</code></a></h6>
<p>Happens in iterator to indicate iteration has to stop.
This error might only be used internally and not sent over the network.</p>
<h5 id="-3211xx-out_of_range-errors"><a class="header" href="#-3211xx-out_of_range-errors"><code>-3211XX</code> <code>OUT_OF_RANGE</code> errors</a></h5>
<h6 id="-321100-out_of_scope"><a class="header" href="#-321100-out_of_scope"><code>-321100</code> <code>OUT_OF_SCOPE</code></a></h6>
<p>Happens when data is accessed, but access is not allowed, because of a limited scope.
E.g. when limiting scope to L2 blocks derived from a specific subset of the L1 chain.</p>
<h5 id="-3212xx-unimplemented-errors"><a class="header" href="#-3212xx-unimplemented-errors"><code>-3212XX</code> <code>UNIMPLEMENTED</code> errors</a></h5>
<h6 id="-321200-cannot_get_parent_of_first_block_in_db"><a class="header" href="#-321200-cannot_get_parent_of_first_block_in_db"><code>-321200</code> <code>CANNOT_GET_PARENT_OF_FIRST_BLOCK_IN_DB</code></a></h6>
<p>Happens when you try to get the previous block of the first block.
E.g. when trying to determine the previous source block for the first L1 block in the database.</p>
<h5 id="-3214xx-unavailable-errors"><a class="header" href="#-3214xx-unavailable-errors"><code>-3214XX</code> <code>UNAVAILABLE</code> errors</a></h5>
<h6 id="-321401-future_data"><a class="header" href="#-321401-future_data"><code>-321401</code> <code>FUTURE_DATA</code></a></h6>
<p>Happens when data is just not yet available.</p>
<h5 id="-3215xx-data_loss-errors"><a class="header" href="#-3215xx-data_loss-errors"><code>-3215XX</code> <code>DATA_LOSS</code> errors</a></h5>
<h6 id="-321500-missed_data"><a class="header" href="#-321500-missed_data"><code>-321500</code> <code>MISSED_DATA</code></a></h6>
<p>Happens when we search the DB, know the data may be there, but is not (e.g. different revision).</p>
<h6 id="-321501-data_corruption"><a class="header" href="#-321501-data_corruption"><code>-321501</code> <code>DATA_CORRUPTION</code></a></h6>
<p>Happens when the underlying DB has some I/O issue.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../interop/verifier.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../interop/managed-node.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../interop/verifier.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../interop/managed-node.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../specs/static/solidity.min.js"></script>
        <script src="../specs/static/mermaid.min.js"></script>
        <script src="../specs/static/mermaid-init.js"></script>
        <script src="../theme/js/footer.js"></script>


    </div>
    </body>
</html>
