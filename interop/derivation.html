<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Derivation - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/interop/derivation.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="derivation"><a class="header" href="#derivation">Derivation</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#invariants">Invariants</a></li>
<li><a href="#omit-user-transactions-in-fork-activation-block">Omit User Transactions in Fork Activation Block</a></li>
<li><a href="#replacing-invalid-blocks">Replacing Invalid Blocks</a>
<ul>
<li><a href="#optimistic-block-deposited-transaction">Optimistic Block Deposited Transaction</a>
<ul>
<li><a href="#optimistic-block-source-hash">Optimistic Block Source-hash</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#network-upgrade-transactions">Network Upgrade Transactions</a>
<ul>
<li><a href="#crossl2inbox-deployment">CrossL2Inbox Deployment</a></li>
<li><a href="#crossl2inbox-proxy-update">CrossL2Inbox Proxy Update</a></li>
<li><a href="#l2tol2crossdomainmessenger-deployment">L2ToL2CrossDomainMessenger Deployment</a></li>
<li><a href="#l2tol2crossdomainmessenger-proxy-update">L2ToL2CrossDomainMessenger Proxy Update</a></li>
</ul>
</li>
<li><a href="#expiry-window">Expiry Window</a></li>
<li><a href="#security-considerations">Security Considerations</a>
<ul>
<li><a href="#depositing-an-executing-message">Depositing an Executing Message</a></li>
<li><a href="#expiry-window-1">Expiry Window</a></li>
<li><a href="#reliance-on-history">Reliance on History</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>New derivation rules are added to guarantee integrity of cross chain messages.
The fork choice rule is updated to fork out unsafe blocks that contain invalid
executing messages.</p>
<h2 id="invariants"><a class="header" href="#invariants">Invariants</a></h2>
<ul>
<li>An executing message MUST have a corresponding initiating message</li>
<li>The initiating message referenced in an executing message MUST come from a chain in its dependency set</li>
<li>A block MUST be considered invalid if it is built with any invalid executing messages</li>
<li>The timestamp of the identifier MUST be greater than the interop network upgrade timestamp</li>
<li>The timestamp of the identifier MUST be less than or equal to the timestamp of the block that includes it</li>
<li>The timestamp of the identifier MUST be greater than timestamp of the block that includes it minus the expiry window</li>
</ul>
<p>L2 blocks that produce invalid executing messages MUST not be allowed to be considered safe.
They MAY optimistically exist as unsafe blocks for some period of time. An L2 block that is invalidated
because it includes invalid executing messages MUST be replaced by a deposits only block at the same
block height. This guarantees progression of the chain, ensuring that an infinite loop of processing
the same block in the proof system is not possible.</p>
<h2 id="omit-user-transactions-in-fork-activation-block"><a class="header" href="#omit-user-transactions-in-fork-activation-block">Omit User Transactions in Fork Activation Block</a></h2>
<p>With the interop hardfork, fork activation blocks no longer include any user transactions. Sequencers, when building
the fork activation block, MUST set <code>noTxPool</code> to <code>true</code> in the execution payload attributes for this block, instructing
the builder to exclude user transactions.</p>
<p>The derivation pipeline MUST enforce that the sequencer has not included any user transactions in the batch covering
the hardfork's activation block. If the sequencer does include any user transactions within the hardfork activation
block, that batch, and the remaining span batch it originated from, MUST be dropped per the
<a href="../protocol/holocene/derivation.html">rules defined in the holocene hardfork</a>.</p>
<h2 id="replacing-invalid-blocks"><a class="header" href="#replacing-invalid-blocks">Replacing Invalid Blocks</a></h2>
<p>When the <a href="./messaging.html#resolving-cross-chain-safety">cross chain dependency resolution</a> determines
that a block contains an <a href="./messaging.html#invalid-messages">invalid message</a>, the block is replaced
by a block with the same inputs, except for the transactions included. The transactions from the
original block are trimmed to include only deposit transactions plus an
<a href="#optimistic-block-deposited-transaction">optimistic block info deposit transaction</a>, which is appended
to the trimmed transaction list.</p>
<h3 id="optimistic-block-deposited-transaction"><a class="header" href="#optimistic-block-deposited-transaction">Optimistic Block Deposited Transaction</a></h3>
<p>An Optimistic Block Deposited Transaction is a system deposited transaction,
inserted into the replacement block,
to signal when a previously derived local-safe block (the "optimistic" block) was invalidated.</p>
<p>This transaction MUST have the following values:</p>
<ol>
<li><code>from</code> is <code>0xdeaddeaddeaddeaddeaddeaddeaddeaddead0002</code>, like the address of the
<a href="../protocol/deposits.html#l1-attributes-depositor-account">L1 Attributes depositor account</a>, but incremented by 1</li>
<li><code>to</code> is <code>0x0000000000000000000000000000000000000000</code> (the zero address as no EVM code execution is expected).</li>
<li><code>mint</code> is <code>0</code></li>
<li><code>value</code> is <code>0</code></li>
<li><code>gasLimit</code> is set <code>36000</code> gas, to cover intrinsic costs, processing costs, and margin for change.</li>
<li><code>isSystemTx</code> is set to <code>false</code>.</li>
<li><code>data</code> is the preimage of the <a href="../glossary.html#l2-output-root-proposals">L2 output root</a>
of the replaced block. i.e. <code>version_byte || payload</code> without applying the <code>keccak256</code> hashing.</li>
<li><code>sourceHash</code> is computed with a new deposit source-hash domain, see below.</li>
</ol>
<p>This system-initiated transaction for L1 attributes is not charged any ETH for its allocated
<code>gasLimit</code>, as it is considered part of state-transition processing.</p>
<h4 id="optimistic-block-source-hash"><a class="header" href="#optimistic-block-source-hash">Optimistic Block Source-hash</a></h4>
<p>The source hash is <a href="../protocol/deposits.html#source-hash-computation">computed</a>
with a source-hash domain: <code>4</code> (instead of <code>1</code>),
combined with the <a href="../glossary.html#l2-output-root-proposals">L2 output root</a> of the optimistic block that was invalidated.</p>
<p>The source-hash is thus computed as:
<code>keccak256(bytes32(uint256(4)), outputRoot))</code>.</p>
<h2 id="network-upgrade-transactions"><a class="header" href="#network-upgrade-transactions">Network Upgrade Transactions</a></h2>
<p>The interop network upgrade timestamp defines the timestamp at which all functionality in this document is considered
the consensus rules for an OP Stack based network. On the interop network upgrade block, a set of deposit transaction
based upgrade transactions are deterministically generated by the derivation pipeline in the following order:</p>
<p>This upgrade requires <code>3_320_000</code> in gas. In order to upgrade successfully the following invariant MUST be maintained:</p>
<pre><code class="language-plaintext">MaxResourceLimit + SystemTxMaxGas + UpgradeGasUsage ≤ L2GasLimit
</code></pre>
<p>With MaxResourceLimit set to <code>20_000_000</code> and SystemTxMaxGas set to <code>1_000_000</code>,
this mean every upgrading chain MUST have their L2GasLimit set to greater than
<code>24_320_000</code>.</p>
<p>The upgrade transaction details below are based on a nightly release at commit
hash <code>71c460ec7c7c05791ddd841b97bcb664a1f0c753</code>, and will be updated once a
contracts release is made.</p>
<!-- To regenerate the deploy/upgrade tx docs below, run `./scripts/upgrades/gen_interop_upgrade_tx_specs.sh | pbcopy` and then paste here -->
<h3 id="crossl2inbox-deployment"><a class="header" href="#crossl2inbox-deployment">CrossL2Inbox Deployment</a></h3>
<!-- Generated with: ./scripts/run_gen_predeploy_docs.sh --optimism-repo-path ../optimism --fork-name Interop --contract-name CrossL2Inbox --from-address 0x4220000000000000000000000000000000000000 --from-address-nonce 0 --git-commit-hash 71c460ec7c7c05791ddd841b97bcb664a1f0c753 --eth-rpc-url https://optimism.rpc.subquery.network/public --proxy-address 0x4200000000000000000000000000000000000022 --copy-contract-bytecode true -->
<p>The <code>CrossL2Inbox</code> contract is deployed.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x4220000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>nonce</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>420000</code></li>
<li><code>data</code>: <code>0x6080604052348015600e575f80fd5b...</code> (<a href="../static/bytecode/interop-cross-l2-inbox-deployment.txt">full bytecode</a>)</li>
<li><code>sourceHash</code>: <code>0x6e5e214f73143df8fe6f6054a3ed7eb472d373376458a9c8aecdf23475beb616</code>,<br />
computed with the "Upgrade-deposited" type, with <code>intent = "Interop: CrossL2Inbox Deployment"</code></li>
</ul>
<p>This results in the Interop CrossL2Inbox contract being deployed to
<code>0x691300f512e48B463C2617b34Eef1A9f82EE7dBf</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x4220000000000000000000000000000000000000
Computed Address: 0x691300f512e48B463C2617b34Eef1A9f82EE7dBf
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Interop: CrossL2Inbox Deployment"))
# 0x6e5e214f73143df8fe6f6054a3ed7eb472d373376458a9c8aecdf23475beb616
</code></pre>
<p>Verify <code>data</code>:</p>
<pre><code class="language-bash">git checkout 71c460ec7c7c05791ddd841b97bcb664a1f0c753
make build-contracts
jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/CrossL2Inbox.sol/CrossL2Inbox.json
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash<br />
<code>0x0e7d028dd71bac22d1fb28966043c8d35c3232c78b7fb99fd1db112b5b60d9dd</code>.</p>
<p>To verify the code hash:</p>
<pre><code class="language-bash">git checkout 71c460ec7c7c05791ddd841b97bcb664a1f0c753
make build-contracts
cast k $(jq -r ".deployedBytecode.object" packages/contracts-bedrock/forge-artifacts/CrossL2Inbox.sol/CrossL2Inbox.json)
</code></pre>
<h3 id="crossl2inbox-proxy-update"><a class="header" href="#crossl2inbox-proxy-update">CrossL2Inbox Proxy Update</a></h3>
<p>This transaction updates the CrossL2Inbox Proxy ERC-1967
implementation slot to point to the new CrossL2Inbox deployment.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x0000000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>0x4200000000000000000000000000000000000022</code> (CrossL2Inbox Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>50,000</code></li>
<li><code>data</code>: <code>0x3659cfe6000000000000000000000000691300f512e48b463c2617b34eef1a9f82ee7dbf</code></li>
<li><code>sourceHash</code>: <code>0x88c6b48354c367125a59792a93a7b60ad7cd66e516157dbba16558c68a46d3cb</code>
computed with the "Upgrade-deposited" type, with <code>intent = "Interop: CrossL2Inbox Proxy Update"</code></li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast concat-hex $(cast sig "upgradeTo(address)") $(cast abi-encode "upgradeTo(address)" 0x691300f512e48B463C2617b34Eef1A9f82EE7dBf)
# 0x3659cfe6000000000000000000000000691300f512e48b463c2617b34eef1a9f82ee7dbf
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Interop: CrossL2Inbox Proxy Update"))
# 0x88c6b48354c367125a59792a93a7b60ad7cd66e516157dbba16558c68a46d3cb
</code></pre>
<h3 id="l2tol2crossdomainmessenger-deployment"><a class="header" href="#l2tol2crossdomainmessenger-deployment">L2ToL2CrossDomainMessenger Deployment</a></h3>
<!-- Generated with: ./scripts/run_gen_predeploy_docs.sh --optimism-repo-path ../optimism --fork-name Interop --contract-name L2ToL2CrossDomainMessenger --from-address 0x4220000000000000000000000000000000000001 --from-address-nonce 0 --git-commit-hash 71c460ec7c7c05791ddd841b97bcb664a1f0c753 --eth-rpc-url https://optimism.rpc.subquery.network/public --proxy-address 0x4200000000000000000000000000000000000023 --copy-contract-bytecode true -->
<p>The <code>L2ToL2CrossDomainMessenger</code> contract is deployed.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x4220000000000000000000000000000000000001</code></li>
<li><code>to</code>: <code>null</code></li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>nonce</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>1100000</code></li>
<li><code>data</code>: <code>0x6080604052348015600e575f80fd5b...</code> (<a href="../static/bytecode/interop-l2-to-l2-cross-domain-messenger-deployment.txt">full bytecode</a>)</li>
<li><code>sourceHash</code>: <code>0xf5484697c7a9a791db32a3bf0763bf2ba686c77ae7d4c0a5ee8c222a92a8dcc2</code>,<br />
computed with the "Upgrade-deposited" type, with <code>intent = "Interop: L2ToL2CrossDomainMessenger Deployment"</code></li>
</ul>
<p>This results in the Interop L2ToL2CrossDomainMessenger contract being deployed to
<code>0x0D0eDd0ebd0e94d218670a8De867Eb5C4d37cadD</code>, to verify:</p>
<pre><code class="language-bash">cast compute-address --nonce=0 0x4220000000000000000000000000000000000001
Computed Address: 0x0D0eDd0ebd0e94d218670a8De867Eb5C4d37cadD
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Interop: L2ToL2CrossDomainMessenger Deployment"))
# 0xf5484697c7a9a791db32a3bf0763bf2ba686c77ae7d4c0a5ee8c222a92a8dcc2
</code></pre>
<p>Verify <code>data</code>:</p>
<pre><code class="language-bash">git checkout 71c460ec7c7c05791ddd841b97bcb664a1f0c753
make build-contracts
jq -r ".bytecode.object" packages/contracts-bedrock/forge-artifacts/L2ToL2CrossDomainMessenger.sol/L2ToL2CrossDomainMessenger.json
</code></pre>
<p>This transaction MUST deploy a contract with the following code hash<br />
<code>0x458925c90ec70736600bef3d6529643a0e7a0a848e62626d61314c057b4a71a9</code>.</p>
<p>To verify the code hash:</p>
<pre><code class="language-bash">git checkout 71c460ec7c7c05791ddd841b97bcb664a1f0c753
make build-contracts
cast k $(jq -r ".deployedBytecode.object" packages/contracts-bedrock/forge-artifacts/L2ToL2CrossDomainMessenger.sol/L2ToL2CrossDomainMessenger.json)
</code></pre>
<h3 id="l2tol2crossdomainmessenger-proxy-update"><a class="header" href="#l2tol2crossdomainmessenger-proxy-update">L2ToL2CrossDomainMessenger Proxy Update</a></h3>
<p>This transaction updates the L2ToL2CrossDomainMessenger Proxy ERC-1967
implementation slot to point to the new L2ToL2CrossDomainMessenger deployment.</p>
<p>A deposit transaction is derived with the following attributes:</p>
<ul>
<li><code>from</code>: <code>0x0000000000000000000000000000000000000000</code></li>
<li><code>to</code>: <code>0x4200000000000000000000000000000000000023</code> (L2ToL2CrossDomainMessenger Proxy)</li>
<li><code>mint</code>: <code>0</code></li>
<li><code>value</code>: <code>0</code></li>
<li><code>gasLimit</code>: <code>50,000</code></li>
<li><code>data</code>: <code>0x3659cfe60000000000000000000000000d0edd0ebd0e94d218670a8de867eb5c4d37cadd</code></li>
<li><code>sourceHash</code>: <code>0xe54b4d06bbcc857f41ae00e89d820339ac5ce0034aac722c817b2873e03a7e68</code>
computed with the "Upgrade-deposited" type, with <code>intent = "Interop: L2ToL2CrossDomainMessenger Proxy Update"</code></li>
</ul>
<p>Verify data:</p>
<pre><code class="language-bash">cast concat-hex $(cast sig "upgradeTo(address)") $(cast abi-encode "upgradeTo(address)" 0x0D0eDd0ebd0e94d218670a8De867Eb5C4d37cadD)
# 0x3659cfe60000000000000000000000000d0edd0ebd0e94d218670a8de867eb5c4d37cadd
</code></pre>
<p>Verify <code>sourceHash</code>:</p>
<pre><code class="language-bash">cast keccak $(cast concat-hex 0x0000000000000000000000000000000000000000000000000000000000000002 $(cast keccak "Interop: L2ToL2CrossDomainMessenger Proxy Update"))
# 0xe54b4d06bbcc857f41ae00e89d820339ac5ce0034aac722c817b2873e03a7e68
</code></pre>
<h2 id="expiry-window"><a class="header" href="#expiry-window">Expiry Window</a></h2>
<p>The expiry window is the time period after which an initiating message is no longer considered valid.</p>
<div class="table-wrapper"><table><thead><tr><th>Constant</th><th>Value</th></tr></thead><tbody>
<tr><td><code>EXPIRY_WINDOW</code></td><td><code>2592000 secs</code> (30 days)</td></tr>
</tbody></table>
</div>
<h2 id="security-considerations"><a class="header" href="#security-considerations">Security Considerations</a></h2>
<h3 id="depositing-an-executing-message"><a class="header" href="#depositing-an-executing-message">Depositing an Executing Message</a></h3>
<p>Deposit transactions (force inclusion transactions) give censorship resistance to layer two networks.
It is possible to deposit an invalid executing message, forcing the sequencer to reorg. It would
be fairly cheap to continuously deposit invalid executing messages through L1 and cause L2 liveness
instability. A future upgrade will enable deposits to trigger executing messages.</p>
<h3 id="expiry-window-1"><a class="header" href="#expiry-window-1">Expiry Window</a></h3>
<p>The expiry window ensures that the proof can execute in a reasonable amount of time. <a href="https://eips.ethereum.org/EIPS/eip-2935"><code>EIP-2935</code></a> introduced
the capability to traverse history with sub-linear complexity, however deep lookups remain expensive. App developers and
users, in the event that they encounter a message that has expired but has yet to be relayed, can
<a href="https://github.com/ethereum-optimism/design-docs/blob/25ef5537e39b63cddf1c83479cee9f0e02431dce/protocol/resend-messages.md#L4">resend the message</a> in order to complete the process.</p>
<h3 id="reliance-on-history"><a class="header" href="#reliance-on-history">Reliance on History</a></h3>
<p>When fully executing historical blocks, a dependency on historical receipts from remote chains is present.
<a href="https://eips.ethereum.org/EIPS/eip-4444">EIP-4444</a> will eventually provide a solution for making historical receipts available without
needing to execute increasingly long chain histories.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../interop/eth-bridging.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../interop/tx-pool.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../interop/eth-bridging.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../interop/tx-pool.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../specs/static/solidity.min.js"></script>
        <script src="../specs/static/mermaid.min.js"></script>
        <script src="../specs/static/mermaid-init.js"></script>


    </div>
    </body>
</html>
