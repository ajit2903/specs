<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Superchain ETH Bridge - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../theme/css/footer.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/interop/superchain-eth-bridge.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="superchainethbridge"><a class="header" href="#superchainethbridge">SuperchainETHBridge</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#constants">Constants</a></li>
<li><a href="#definitions">Definitions</a>
<ul>
<li><a href="#eth-bridging">ETH Bridging</a></li>
<li><a href="#eth-liquidity">ETH Liquidity</a></li>
<li><a href="#cross-chain-message">Cross-Chain Message</a></li>
<li><a href="#source-chain">Source Chain</a></li>
<li><a href="#destination-chain">Destination Chain</a></li>
</ul>
</li>
<li><a href="#assumptions">Assumptions</a>
<ul>
<li><a href="#aseb-001-l2tol2crossdomainmessenger-properly-delivers-messages">aSEB-001: L2ToL2CrossDomainMessenger properly delivers messages</a>
<ul>
<li><a href="#mitigations">Mitigations</a></li>
</ul>
</li>
<li><a href="#aseb-002-ethliquidity-contract-maintains-sufficient-liquidity">aSEB-002: <code>ETHLiquidity</code> contract maintains sufficient liquidity</a>
<ul>
<li><a href="#mitigations-1">Mitigations</a></li>
</ul>
</li>
<li><a href="#aseb-003-safesend-correctly-transfers-eth-to-recipients">aSEB-003: <code>SafeSend</code> correctly transfers ETH to recipients</a>
<ul>
<li><a href="#mitigations-2">Mitigations</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#invariants">Invariants</a>
<ul>
<li><a href="#iseb-001-eth-sent-equals-eth-received">iSEB-001: ETH sent equals ETH received</a>
<ul>
<li><a href="#impact">Impact</a></li>
<li><a href="#dependencies">Dependencies</a></li>
</ul>
</li>
<li><a href="#iseb-002-only-authorized-contracts-can-call-relayeth">iSEB-002: Only authorized contracts can call <code>relayETH</code></a>
<ul>
<li><a href="#impact-1">Impact</a></li>
<li><a href="#dependencies-1">Dependencies</a></li>
</ul>
</li>
<li><a href="#iseb-003-eth-cannot-be-sent-to-the-zero-address">iSEB-003: ETH cannot be sent to the zero address</a>
<ul>
<li><a href="#impact-2">Impact</a></li>
<li><a href="#dependencies-2">Dependencies</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#function-specification">Function Specification</a>
<ul>
<li><a href="#sendeth">sendETH</a></li>
<li><a href="#relayeth">relayETH</a></li>
</ul>
</li>
<li><a href="#events">Events</a>
<ul>
<li><a href="#sendeth">SendETH</a></li>
<li><a href="#relayeth">RelayETH</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The <code>SuperchainETHBridge</code> is a predeploy contract that facilitates cross-chain ETH bridging within
the Superchain interop set. It serves as an abstraction layer on top of the
<code>L2toL2CrossDomainMessenger</code> specifically designed for native ETH transfers between chains. The
contract integrates with the <code>ETHLiquidity</code> contract to manage native ETH liquidity across chains,
ensuring seamless cross-chain transfers of native ETH.</p>
<p>The <code>SuperchainETHBridge</code> only handles native ETH cross-chain transfers. For interoperable ETH
withdrawals, see the <a href="./eth-lockbox.html"><code>ETHLockbox</code></a> specification.</p>
<h2 id="constants"><a class="header" href="#constants">Constants</a></h2>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Value</th></tr></thead><tbody>
<tr><td><code>SuperchainETHBridge</code> Address</td><td><code>0x4200000000000000000000000000000000000024</code></td></tr>
</tbody></table>
</div>
<h2 id="definitions"><a class="header" href="#definitions">Definitions</a></h2>
<h3 id="eth-bridging"><a class="header" href="#eth-bridging">ETH Bridging</a></h3>
<p>ETH Bridging refers to the process of transferring native ETH from one chain to another within the
Superchain interop set. This process involves burning ETH on the source chain and minting an
equivalent amount on the destination chain.</p>
<h3 id="eth-liquidity"><a class="header" href="#eth-liquidity">ETH Liquidity</a></h3>
<p>ETH Liquidity refers to the availability of native ETH on a particular chain. The <code>ETHLiquidity</code>
contract manages this liquidity by providing a mechanism to burn and mint ETH as needed for
cross-chain transfers.</p>
<h3 id="cross-chain-message"><a class="header" href="#cross-chain-message">Cross-Chain Message</a></h3>
<p>A Cross-Chain Message is a message sent from one chain to another using the
<code>L2ToL2CrossDomainMessenger</code>. In the context of the <code>SuperchainETHBridge</code>, these messages contain
instructions to relay ETH to a recipient on the destination chain.</p>
<h3 id="source-chain"><a class="header" href="#source-chain">Source Chain</a></h3>
<p>The Source Chain is the chain from which a user initiates an ETH transfer. On this chain, ETH is
burned from the user's account and a cross-chain message is sent to the destination chain.</p>
<h3 id="destination-chain"><a class="header" href="#destination-chain">Destination Chain</a></h3>
<p>The Destination Chain is the chain to which ETH is being transferred. On this chain, ETH is sent
to the recipient's account based on the cross-chain message received from the source chain.</p>
<h2 id="assumptions"><a class="header" href="#assumptions">Assumptions</a></h2>
<h3 id="aseb-001-l2tol2crossdomainmessenger-properly-delivers-messages"><a class="header" href="#aseb-001-l2tol2crossdomainmessenger-properly-delivers-messages">aSEB-001: L2ToL2CrossDomainMessenger properly delivers messages</a></h3>
<p>We assume that the <code>L2ToL2CrossDomainMessenger</code> contract properly and faithfully delivers messages
between chains, maintaining the integrity and authenticity of the message contents.</p>
<h4 id="mitigations"><a class="header" href="#mitigations">Mitigations</a></h4>
<ul>
<li>Extensive testing of the <code>L2ToL2CrossDomainMessenger</code> contract</li>
<li>Audits of the messaging protocol</li>
<li>Monitoring of cross-chain message delivery</li>
</ul>
<h3 id="aseb-002-ethliquidity-contract-maintains-sufficient-liquidity"><a class="header" href="#aseb-002-ethliquidity-contract-maintains-sufficient-liquidity">aSEB-002: <code>ETHLiquidity</code> contract maintains sufficient liquidity</a></h3>
<p>We assume that the <code>ETHLiquidity</code> contract maintains sufficient liquidity to fulfill all valid ETH
minting requests. This is ensured by initializing the contract with <code>type(uint248).max</code> wei.</p>
<h4 id="mitigations-1"><a class="header" href="#mitigations-1">Mitigations</a></h4>
<ul>
<li>Total ETH supply is much less than the initial balance of the <code>ETHLiquidity</code> contract</li>
<li>Contract is initially initialized with <code>type(uint248).max</code> wei and can hold up to
<code>type(uint256).max</code> wei to prevent balance overflow</li>
</ul>
<h3 id="aseb-003-safesend-correctly-transfers-eth-to-recipients"><a class="header" href="#aseb-003-safesend-correctly-transfers-eth-to-recipients">aSEB-003: <code>SafeSend</code> correctly transfers ETH to recipients</a></h3>
<p>We assume that the <code>SafeSend</code> mechanism correctly transfers ETH to recipients without reverting
for valid addresses.</p>
<h4 id="mitigations-2"><a class="header" href="#mitigations-2">Mitigations</a></h4>
<ul>
<li>Extensive testing of the <code>SafeSend</code> mechanism</li>
<li>Audits of the ETH transfer logic</li>
</ul>
<h2 id="invariants"><a class="header" href="#invariants">Invariants</a></h2>
<h3 id="iseb-001-eth-sent-equals-eth-received"><a class="header" href="#iseb-001-eth-sent-equals-eth-received">iSEB-001: ETH sent equals ETH received</a></h3>
<p>The amount of ETH sent from the source chain must equal the amount of ETH received on the
destination chain for any given cross-chain transfer.</p>
<h4 id="impact"><a class="header" href="#impact">Impact</a></h4>
<p><strong>Severity: Critical</strong></p>
<p>If this invariant is broken, users could receive more or less ETH than they sent, leading to
inflation or loss of funds.</p>
<h4 id="dependencies"><a class="header" href="#dependencies">Dependencies</a></h4>
<ul>
<li><a href="#aseb-001-l2tol2crossdomainmessenger-properly-delivers-messages">aSEB-001</a></li>
<li><a href="#aseb-002-ethliquidity-contract-maintains-sufficient-liquidity">aSEB-002</a></li>
</ul>
<h3 id="iseb-002-only-authorized-contracts-can-call-relayeth"><a class="header" href="#iseb-002-only-authorized-contracts-can-call-relayeth">iSEB-002: Only authorized contracts can call <code>relayETH</code></a></h3>
<p>The <code>relayETH</code> function must only be callable by the <code>L2ToL2CrossDomainMessenger</code> contract, and the
cross-domain sender must be the <code>SuperchainETHBridge</code> contract on the source chain.</p>
<h4 id="impact-1"><a class="header" href="#impact-1">Impact</a></h4>
<p><strong>Severity: Critical</strong></p>
<p>If this invariant is broken, unauthorized parties could mint ETH on the destination chain without
burning an equivalent amount on the source chain, leading to inflation.</p>
<h4 id="dependencies-1"><a class="header" href="#dependencies-1">Dependencies</a></h4>
<ul>
<li><a href="#aseb-001-l2tol2crossdomainmessenger-properly-delivers-messages">aSEB-001</a></li>
</ul>
<h3 id="iseb-003-eth-cannot-be-sent-to-the-zero-address"><a class="header" href="#iseb-003-eth-cannot-be-sent-to-the-zero-address">iSEB-003: ETH cannot be sent to the zero address</a></h3>
<p>The <code>sendETH</code> function must revert if the recipient address is the zero address.</p>
<h4 id="impact-2"><a class="header" href="#impact-2">Impact</a></h4>
<p><strong>Severity: High</strong></p>
<p>If this invariant is broken, ETH could be sent to the zero address, effectively burning it without
the possibility of recovery.</p>
<h4 id="dependencies-2"><a class="header" href="#dependencies-2">Dependencies</a></h4>
<p>None</p>
<h2 id="function-specification"><a class="header" href="#function-specification">Function Specification</a></h2>
<h3 id="sendeth"><a class="header" href="#sendeth">sendETH</a></h3>
<p>Deposits the <code>msg.value</code> of ETH into the <code>ETHLiquidity</code> contract and sends a cross-chain message
to the specified <code>_chainId</code> to call <code>relayETH</code> with the <code>_to</code> address as the recipient and the
<code>msg.value</code> as the amount.</p>
<pre><code class="language-solidity">function sendETH(address _to, uint256 _chainId) external payable returns (bytes32 msgHash_);
</code></pre>
<ul>
<li>MUST accept ETH via <code>msg.value</code>.</li>
<li>MUST revert if the <code>_to</code> address is the zero address.</li>
<li>MUST transfer <code>msg.value</code> of ETH from the <code>msg.sender</code> to the <code>ETHLiquidity</code> contract by calling
<code>ETHLiquidity.burn{value: msg.value}()</code>.</li>
<li>MUST create a cross-chain message to the <code>SuperchainETHBridge</code> contract on the destination chain
with the following parameters:
<ul>
<li><code>_chainId</code>: The destination chain ID.</li>
<li><code>message</code>: An encoded call to <code>relayETH(msg.sender, _to, msg.value)</code>.</li>
</ul>
</li>
<li>MUST return the message hash <code>msgHash_</code> generated by the <code>L2ToL2CrossDomainMessenger</code>.</li>
<li>MUST emit a <code>SendETH</code> event with the <code>msg.sender</code>, <code>_to</code>, <code>msg.value</code>, and <code>_chainId</code>.</li>
</ul>
<h3 id="relayeth"><a class="header" href="#relayeth">relayETH</a></h3>
<p>Withdraws ETH from the <code>ETHLiquidity</code> contract equal to the <code>_amount</code> and sends it to the <code>_to</code> address.</p>
<pre><code class="language-solidity">function relayETH(address _from, address _to, uint256 _amount) external;
</code></pre>
<ul>
<li>MUST revert if called by any address other than the <code>L2ToL2CrossDomainMessenger</code>.</li>
<li>MUST revert if the cross-domain sender is not the <code>SuperchainETHBridge</code> contract on the source
chain.</li>
<li>MUST withdraw <code>_amount</code> of ETH from the <code>ETHLiquidity</code> contract by calling
<code>ETHLiquidity.mint(_amount)</code>.</li>
<li>MUST transfer the <code>_amount</code> of ETH to the <code>_to</code> address using
<code>new SafeSend{value: _amount}(_to)</code>.</li>
<li>MUST emit a <code>RelayETH</code> event with the <code>_from</code> address, <code>_to</code> address, <code>_amount</code>, and source chain
ID.</li>
</ul>
<h2 id="events"><a class="header" href="#events">Events</a></h2>
<h3 id="sendeth-1"><a class="header" href="#sendeth-1">SendETH</a></h3>
<p>MUST be triggered when <code>sendETH</code> is called.</p>
<pre><code class="language-solidity">event SendETH(address indexed from, address indexed to, uint256 amount, uint256 destination);
</code></pre>
<h3 id="relayeth-1"><a class="header" href="#relayeth-1">RelayETH</a></h3>
<p>MUST be triggered when <code>relayETH</code> is called.</p>
<pre><code class="language-solidity">event RelayETH(address indexed from, address indexed to, uint256 amount, uint256 source);
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../interop/eth-liquidity.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../interop/eth-bridging.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../interop/eth-liquidity.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../interop/eth-bridging.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../specs/static/solidity.min.js"></script>
        <script src="../specs/static/mermaid.min.js"></script>
        <script src="../specs/static/mermaid-init.js"></script>
        <script src="../theme/js/footer.js"></script>


    </div>
    </body>
</html>
