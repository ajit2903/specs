<!DOCTYPE HTML>
<html lang="en" class="ayu sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Background - OP Stack Specification</title>


        <!-- Custom HTML head -->
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-YNLKSPKGWN"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag() { dataLayer.push(arguments); }
            gtag('js', new Date());
            gtag('config', 'G-YNLKSPKGWN');
        </script>
        <meta name="google-site-verification" content="1XjEcxxHshd6NM_mxbl_uv-SyamI6_99aOpILYI3_mk" />

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/css/footer.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">OP Stack Specification</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/ethereum-optimism/specs/edit/main/specs/background.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css">
<h1 id="background"><a class="header" href="#background">Background</a></h1>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<p><strong>Table of Contents</strong></p>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#foundations">Foundations</a>
<ul>
<li><a href="#ethereum-scalability">Ethereum Scalability</a></li>
<li><a href="#optimistic-rollups">Optimistic Rollups</a></li>
<li><a href="#evm-equivalence">EVM Equivalence</a></li>
</ul>
</li>
<li><a href="#protocol-guarantees">Protocol Guarantees</a>
<ul>
<li><a href="#liveness">Liveness</a></li>
<li><a href="#validity">Validity</a></li>
<li><a href="#availability">Availability</a></li>
</ul>
</li>
<li><a href="#network-participants">Network Participants</a>
<ul>
<li><a href="#users">Users</a></li>
<li><a href="#sequencers">Sequencers</a></li>
<li><a href="#verifiers">Verifiers</a></li>
</ul>
</li>
<li><a href="#key-interaction-diagrams">Key Interaction Diagrams</a>
<ul>
<li><a href="#depositing-and-sending-transactions">Depositing and Sending Transactions</a></li>
<li><a href="#withdrawing">Withdrawing</a></li>
</ul>
</li>
<li><a href="#next-steps">Next Steps</a></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>The OP Stack is a decentralized software stack maintained by the OP Stack that forms the backbone of blockchains like
<a href="https://explorer.optimism.io/">OP Mainnet</a> and <a href="https://base.org">Base</a>. The OP Stack provides the infrastructure for
operating EVM equivalent rollup blockchains designed to scale Ethereum while remaining maximally compatible with
existing Ethereum infrastructure. This document provides an overview of the protocol to provide context for the rest of
the specification.</p>
<h2 id="foundations"><a class="header" href="#foundations">Foundations</a></h2>
<h3 id="ethereum-scalability"><a class="header" href="#ethereum-scalability">Ethereum Scalability</a></h3>
<p>Scaling Ethereum means increasing the number of useful transactions the Ethereum network can process. Ethereum's
limited resources, specifically bandwidth, computation, and storage, constrain the number of transactions which can be
processed on the network. Of the three resources, computation and storage are currently the most significant
bottlenecks. These bottlenecks limit the supply of transactions, leading to extremely high fees. Scaling ethereum and
reducing fees can be achieved by better utilizing bandwidth, computation and storage.</p>
<h3 id="optimistic-rollups"><a class="header" href="#optimistic-rollups">Optimistic Rollups</a></h3>
<p>An <a href="https://vitalik.eth.limo/general/2021/01/05/rollup.html">Optimistic Rollup</a> is a layer 2 scalability construction which
increases the computation &amp; storage capacity of Ethereum while aiming to minimize sacrifices to scalability or
decentralization. In a nutshell, an Optimistic Rollup utilizes Ethereum (or some other data availability layer) to host
transaction data. Layer 2 nodes then execute a state transition function over this data. Users can propose the result of
this off-chain execution to a smart contract on L1. A "fault proving" process can then demonstrate that a user's proposal
is (or is not) valid.</p>
<h3 id="evm-equivalence"><a class="header" href="#evm-equivalence">EVM Equivalence</a></h3>
<p><a href="https://medium.com/ethereum-optimism/introducing-evm-equivalence-5c2021deb306">EVM Equivalence</a> is complete compliance
with the state transition function described in the Ethereum yellow paper, the formal definition of the protocol. By
conforming to the Ethereum standard across EVM equivalent rollups, smart contract developers can write once and deploy
anywhere.</p>
<h2 id="protocol-guarantees"><a class="header" href="#protocol-guarantees">Protocol Guarantees</a></h2>
<p>We strive to preserve three critical properties: liveness, validity, and availability.
A protocol that can maintain these properties can, effectively, scale Ethereum without sacrificing security.</p>
<h3 id="liveness"><a class="header" href="#liveness">Liveness</a></h3>
<p>Liveness is defined as the ability for any party to be able to extend the rollup chain by including a transaction within
a bounded amount of time. It should not be possible for an actor to block the inclusion of any given transaction for more
than this bounded time period. This bounded time period should also be acceptable such that inclusion is not just
theoretically possible but practically useful.</p>
<h3 id="validity"><a class="header" href="#validity">Validity</a></h3>
<p>Validity is defined as the ability for any party to execute the rollup state transition function, subject to certain lower
bound expectations for available computing and bandwidth resources. Validity is also extended to refer to the ability for
a smart contract on Ethereum to be able to validate this state transition function economically.</p>
<h3 id="availability"><a class="header" href="#availability">Availability</a></h3>
<p>Availability is defined as the ability for any party to retrieve the inputs that are necessary to execute the rollup state
transition function correctly. Availability is essentially an element of validity and is required to be able to guarantee
validity in general. Similar to validity, availability is subject to lower bound resource requirements.</p>
<h2 id="network-participants"><a class="header" href="#network-participants">Network Participants</a></h2>
<p>Generally speaking, there are three primary actors that interact with an OP Stack chain: users, sequencers, and verifiers.</p>
<pre class="mermaid">graph TD
    EthereumL1(Ethereum L1)

    subgraph &quot;L2 Participants&quot;
        Users(Users)
        Sequencers(Sequencers)
        Verifiers(Verifiers)
    end

    Verifiers -.-&gt;|fetch transaction batches| EthereumL1
    Verifiers -.-&gt;|fetch deposit data| EthereumL1
    Verifiers --&gt;|submit/validate/challenge output proposals| EthereumL1
    Verifiers -.-&gt;|fetch realtime P2P updates| Sequencers
    
    Users --&gt;|submit deposits/withdrawals| EthereumL1
    Users --&gt;|submit transactions| Sequencers
    Users --&gt;|query data| Verifiers


    Sequencers --&gt;|submit transaction batches| EthereumL1
    Sequencers -.-&gt;|fetch deposit data| EthereumL1

    classDef l1Contracts stroke:#bbf,stroke-width:2px;
    classDef l2Components stroke:#333,stroke-width:2px;
    classDef systemUser stroke:#f9a,stroke-width:2px;

    class EthereumL1 l1Contracts;
    class Users,Sequencers,Verifiers l2Components;
</pre>
<h3 id="users"><a class="header" href="#users">Users</a></h3>
<p>Users are the general class of network participants who:</p>
<ul>
<li>Submit transactions through a Sequencer or by interacting with contracts on Ethereum.</li>
<li>Query transaction data from interfaces operated by verifiers.</li>
</ul>
<h3 id="sequencers"><a class="header" href="#sequencers">Sequencers</a></h3>
<p>Sequencers fill the role of the block producer on an OP Stack chain. Chains may have a single Sequencer or may choose to
utilize some consensus protocol that coordinates multiple Sequencers. The OP Stack currently officially only supports a
single active Sequencer at any given time. In general, specifications may use the term "the Sequencer" as a stand-in for
either a single Sequencer or a consensus protocol of multiple Sequencers.</p>
<p>The Sequencer:</p>
<ul>
<li>Accepts transactions directly from Users.</li>
<li>Observes "deposit" transactions generated on Ethereum.</li>
<li>Consolidates both transaction streams into ordered L2 blocks.</li>
<li>Submits information to L1 that is sufficient to fully reproduce those L2 blocks.</li>
<li>Provides real-time access to pending L2 blocks that have not yet been confirmed on L1.</li>
</ul>
<p>The Sequencer serves an important role for the operation of an L2 chain but is not a trusted actor. The Sequencer is generally
responsible for improving the user experience by ordering transactions much more quickly and cheaply than would currently
be possible if users were to submit all transactions directly to L1.</p>
<h3 id="verifiers"><a class="header" href="#verifiers">Verifiers</a></h3>
<p>Verifiers download and execute the L2 state transition function independently of the Sequencer. Verifiers help to maintain
the integrity of the network and serve blockchain data to Users.</p>
<p>Verifiers generally:</p>
<ul>
<li>Download rollup data from L1 and the Sequencer.</li>
<li>Use rollup data to execute the L2 state transition function.</li>
<li>Serve rollup data and computed L2 state information to Users.</li>
</ul>
<p>Verifiers can also act as Proposers and/or Challengers who:</p>
<ul>
<li>Submit assertions about the state of the L2 to a smart contract on L1.</li>
<li>Validate assertions made by other participants.</li>
<li>Dispute invalid assertions made by other participants.</li>
</ul>
<h2 id="key-interaction-diagrams"><a class="header" href="#key-interaction-diagrams">Key Interaction Diagrams</a></h2>
<h3 id="depositing-and-sending-transactions"><a class="header" href="#depositing-and-sending-transactions">Depositing and Sending Transactions</a></h3>
<p>Users will often begin their L2 journey by depositing ETH from L1.
Once they have ETH to pay fees, they'll start sending transactions on L2.
The following diagram demonstrates this interaction and all key OP Stack components which are or should be utilized:</p>
<pre class="mermaid">graph TD
    subgraph &quot;Ethereum L1&quot;
        OptimismPortal(&lt;a href=&quot;./protocol/withdrawals.html#the-optimism-portal-contract&quot;&gt;OptimismPortal&lt;/a&gt;)
        BatchInbox(&lt;a href=&quot;../glossary.html#batcher-transaction&quot;&gt;Batch Inbox Address&lt;/a&gt;)
    end

    Sequencer(Sequencer)
    Users(Users)

    %% Interactions
    Users --&gt;|&lt;b&gt;1.&lt;/b&gt; submit deposit| OptimismPortal
    Sequencer -.-&gt;|&lt;b&gt;2.&lt;/b&gt; fetch deposit events| OptimismPortal
    Sequencer --&gt;|&lt;b&gt;3.&lt;/b&gt; generate deposit block| Sequencer
    Users --&gt;|&lt;b&gt;4.&lt;/b&gt; send transactions| Sequencer
    Sequencer --&gt;|&lt;b&gt;5.&lt;/b&gt; submit transaction batches| BatchInbox

    classDef l1Contracts stroke:#bbf,stroke-width:2px;
    classDef l2Components stroke:#333,stroke-width:2px;
    classDef systemUser stroke:#f9a,stroke-width:2px;

    class OptimismPortal,BatchInbox l1Contracts;
    class Sequencer l2Components;
    class Users systemUser;
</pre>
<h3 id="withdrawing"><a class="header" href="#withdrawing">Withdrawing</a></h3>
<p>Users may also want to withdraw ETH or ERC20 tokens from an OP Stack chain back to Ethereum. Withdrawals are initiated
as standard transactions on L2 but are then completed using transactions on L1. Withdrawals must reference a valid
<code>FaultDisputeGame</code> contract that proposes the state of the L2 at a given point in time.</p>
<pre class="mermaid">graph LR
    subgraph &quot;Ethereum L1&quot;
        BatchInbox(&lt;a href=&quot;../glossary.html#batcher-transaction&quot;&gt;Batch Inbox Address&lt;/a&gt;)
        DisputeGameFactory(&lt;a href=&quot;../fault-proof/stage-one/dispute-game-interface.html#disputegamefactory-interface&quot;&gt;DisputeGameFactory&lt;/a&gt;)
        FaultDisputeGame(&lt;a href=&quot;../fault-proof/stage-one/fault-dispute-game.html&quot;&gt;FaultDisputeGame&lt;/a&gt;)
        OptimismPortal(&lt;a href=&quot;./protocol/withdrawals.html#the-optimism-portal-contract&quot;&gt;OptimismPortal&lt;/a&gt;)
        ExternalContracts(External Contracts)
    end

    Sequencer(Sequencer)
    Proposers(Proposers)
    Users(Users)

    %% Interactions
    Users --&gt;|&lt;b&gt;1.&lt;/b&gt; send withdrawal initialization txn| Sequencer
    Sequencer --&gt;|&lt;b&gt;2.&lt;/b&gt; submit transaction batch| BatchInbox
    Proposers --&gt;|&lt;b&gt;3.&lt;/b&gt; submit output proposal| DisputeGameFactory
    DisputeGameFactory --&gt;|&lt;b&gt;4.&lt;/b&gt; generate game| FaultDisputeGame
    Users --&gt;|&lt;b&gt;5.&lt;/b&gt; submit withdrawal proof| OptimismPortal
    Users --&gt;|&lt;b&gt;6.&lt;/b&gt; wait for finalization| FaultDisputeGame
    Users --&gt;|&lt;b&gt;7.&lt;/b&gt; submit withdrawal finalization| OptimismPortal
    OptimismPortal --&gt;|&lt;b&gt;8.&lt;/b&gt; check game validity| FaultDisputeGame
    OptimismPortal --&gt;|&lt;b&gt;9.&lt;/b&gt; execute withdrawal transaction| ExternalContracts

    %% Styling
    classDef l1Contracts stroke:#bbf,stroke-width:2px;
    classDef l2Components stroke:#333,stroke-width:2px;
    classDef systemUser stroke:#f9a,stroke-width:2px;

    class BatchInbox,DisputeGameFactory,FaultDisputeGame,OptimismPortal l1Contracts;
    class Sequencer l2Components;
    class Users,Proposers systemUser;
</pre>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>Check out the sidebar to the left to find any specification you might want to read, or click one of the links embedded
in one of the above diagrams to learn about particular components that have been mentioned.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="root.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="protocol/overview.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="root.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="protocol/overview.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="specs/static/solidity.min.js"></script>
        <script src="specs/static/mermaid.min.js"></script>
        <script src="specs/static/mermaid-init.js"></script>
        <script src="theme/js/footer.js"></script>


    </div>
    </body>
</html>
